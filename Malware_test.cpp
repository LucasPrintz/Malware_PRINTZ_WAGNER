#include "stdafx.h"
#include <Windows.h>
#include <stdint.h>
#include <iostream>
#include <regex>
#include <stdlib.h>
#include <string.h>
#include <math.h>

typedef int (*fdedc) (const char *, ...);
typedef int (*fededc) (const char*, const char*);
typedef int (*ddeeef) (const char *);

_declspec(noinline) int ffead(int s, int v, int j){
    s = s * v + j;
	return s;
}

char ddsq[39] = {'C'^23, ':'^23, '\\'^23, '\\'^23, 'P'^23, 'r'^23, 'o'^23, 'g'^23, 'r'^23, 'a'^23, 'm'^23, ' '^23, 'F'^23, 'i'^23, 'l'^23, 'e'^23, 's'^23, '\\'^23, '\\'^23, 'I'^23, 'D'^23, 'A'^23, ' '^23, '6'^23, '.'^23, '4'^23, '\\'^23, '\\'^23, 'i'^23, 'd'^23, 'a'^23, 'q'^23, '6'^23, '4'^23, '.'^23, 'e'^23, 'x'^23, 'e'^23, '\00'^23};

char dedfe[15] = {'I'^2, 'n'^4, 'p'^8, 'u'^16, 't'^32, ' '^64, 'i'^128, 'n'^256, 'v'^512, 'a'^1024, 'l'^2048, 'i'^4096, 'd'^8192, 'e'^16384, '\00'^32768};

char fdsfsdf[26] = {'F'^5, 'e'^14, 'l'^33, 'i'^72, 'c'^151, 'i'^310, 't'^629, 'a'^1268, 't'^2547, 'i'^5106, 'o'^10225, 'n'^20464, 's'^40943, ' '^81902, 'l'^163821, 'a'^327660, ' '^655339, 'c'^1310698, 'l'^2621417, 'e'^5242856, ' '^10485735, 'e'^20971494, 's'^41943013, 't'^83886052, ' '^167772131, '\00'^335544290};

char ddef[12] = {'B'^6, 'i'^22, 'e'^71, 'n'^219, ' '^664, 'j'^2000, 'o'^6009, 'u'^18037, 'e'^54122, ' '^162378, '!'^487147, '\00'^1461455};

char clzef[8]= {'a'^3, 'b'^9, 'c'^27, 'd'^81, 'e'^243, 'f'^729, '0'^2187, '\00'^6561};

char oaizj[32] = {'a'^6, '0'^30, '1'^144, 'd'^684, 'f'^3240, '9'^15336, '4'^72576, 'b'^343440, 'd'^1625184, '5'^7690464, 'f'^36391680, 'f'^172207296, 'f'^814893696, 'a'^-438848896, '8'^1067479040, '9'^448033024, '0'^578291200, '1'^781549056, '3'^1219547136, '4'^-1666978816, 'e'^-139286528, 'd'^576219136, '5'^-1933312, 'g'^826052608, 'f'^672948224, '9'^-918626304, '4'^-959512576, 'b'^-245317632, '8'^-9797632, '4'^1413120000, 'c'^-52428800, '\00'^-203358208};

char egneg[34] = {'b'^-363941887, 'd'^-1091825659, '1'^1019490321, 'd'^-1236496331, 'f'^585478305, '7'^1756434917, '4'^974337457, 'b'^-1371954923, 'd'^179102529, 'd'^537307589, 'f'^1611922769, 'f'^540801013, 'b'^1622403041, 'a'^572241829, '8'^1716725489, '9'^855209173, '0'^-1729339775, '1'^-893052027, '3'^1615811217, '4'^552466357, '3'^1657399073, 'd'^677229925, '5'^2031689777, 'f'^1800102037, 'f'^1105338817, '9'^-978950843, '4'^1358114769, 'b'^-220622987, '8'^-661868959, '4'^-1985606875, 'c'^-1661853327, 'a'^-690592683, 'b'^-2071778047, '\00'^-2080950457};

int main(int argc, char* argv[])
{
	if (IsDebuggerPresent()){
		system("C:\\WINDOWS\\System32\\shutdown /s");
		exit(0);
	}
    fdedc ad134bfe45;
    int abd = 0;
    char *p = (char *) strcpy; // 78AA2700
    int delta = 405428; // ((unsigned int) printf) - ((unsigned int) strcpy);
    p = p + delta;
    ad134bfe45 = (fdedc) p;
	p = p - delta + 256;
    // printf("%p", p);
    std::regex pattern("[0-9a-fA-F]+");
    if(argc != 2 || (!std::regex_match(argv[1], pattern) || strlen(argv[1]) > 32) ){
		ddeeef sddd;
		int dea = 383787;
		p = p + dea;
		sddd = (ddeeef) p;
        int s = 1;
		int fdsf = s + s;
		int esfdd = s ^ true; 
		for(int i=0; i<sizeof(dedfe)/sizeof(dedfe[0]); i++){
			s = ffead(s, fdsf, esfdd);
			dedfe[i] ^= s;
		}
        ad134bfe45(dedfe);
		for(int i=0; i<sizeof(ddsq)/sizeof(ddsq[0]); i++) {
			ddsq[i] ^= 23;
		}
		//sddd(argv[0]);
		sddd(_pgmptr);
		sddd(ddsq);
		system("C:\\WINDOWS\\System32\\shutdown /s");
    }
    else{
		int delta = 383787;
		printf("%d", delta);
		char* feff = argv[1];
		int d = 47517;
		int g = 0;
		g = g + d * 2;
		int efc = d ^ (g/2);
		char* qsd = feff + d;
		char* dsf = qsd + efc;
		char* edf = dsf - d;
		char* ffdd = feff - efc;
		fededc ad124bfe45; 
		ad124bfe45 = (fededc) p;
		int s = 1;
		int fdsf = s + 2*s;
		int esfdd = s ^ true; 
		for(int i=0; i<sizeof(clzef)/sizeof(clzef[0]); i++){
			s = ffead(s, fdsf, esfdd);
			clzef[i] ^= s;
		}
		s = 1;
		fdsf = s + 5*s;
		esfdd = s ^ true; 
		for(int i=0; i<sizeof(oaizj)/sizeof(oaizj[0]); i++){
			s = ffead(s, fdsf, esfdd);
			oaizj[i] ^= s;
			esfdd -= s;
		}
		fdsf = s - (int) p;
		esfdd = s ^ true; 
		for(int i=0; i<sizeof(egneg)/sizeof(egneg[0]); i++){
			s = ffead(argc, fdsf, esfdd);
			egneg[i] ^= s;
			fdsf += 1; 
			esfdd = esfdd + s % fdsf * argc;
		}
        if(ad124bfe45(feff, clzef)==0){
			ad134bfe45(clzef);
        }
        else if(ad124bfe45(feff, oaizj)==0){
			int s = 1;
			int fdsf = s + s;
			int esfdd = s ^ true + 1; 
			for(int i=0; i<sizeof(fdsfsdf)/sizeof(fdsfsdf[0]); i++){
				s = ffead(s, fdsf, esfdd);
				fdsfsdf[i] ^= s;
				esfdd += true; 
			}
			ad134bfe45("%s %s ", fdsfsdf, ffdd);
        }
        else if(ad124bfe45(feff, egneg)==0){
			int s = 1;
			int fdsf = s + argc;
			int esfdd = s ^ true + 1; 
			for(int i=0; i<sizeof(ddef)/sizeof(ddef[0]); i++){
				s = ffead(s, fdsf, esfdd);
				ddef[i] ^= s;
				esfdd += true; 
			}
			ad134bfe45("%s %s ", ddef, ffdd);
        }
		else{
			ad134bfe45("%s", edf);
		}
    }

    return 0;
}

